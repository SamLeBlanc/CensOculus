<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CensusMapper</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css" type="text/css">
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/styles.css">
  <link rel="stylesheet" href="styles/sidebar.css">
  <script type="text/javascript" src="index.js"></script>
  <script type="text/javascript" src="scripts/dataLoadingAndManipulation.js"></script>
  <script type="text/javascript" src="scripts/addSourcesAndLayers.js"></script>
  <script type="text/javascript" src="scripts/DICTIONARIES.js"></script>
  <script type="text/javascript" src="scripts/INTRO.js"></script>
  <script type="text/javascript" src="scripts/snapshotHoverStates.js"></script>
  <script type="text/javascript" src="scripts/customRanges.js"></script>
  <script type="text/javascript" src="scripts/featureStatus.js"></script>
  <script type="text/javascript" src="scripts/numberFormats.js"></script>
  <script type="text/javascript" src="scripts/coloring.js"></script>
  <script type="text/javascript" src="scripts/tableJunk.js"></script>
  <script type="text/javascript" src="scripts/setup.js"></script>
  <script type="text/javascript" src="scripts/flags.js"></script>
  <script type="text/javascript" src="scripts/mapControls.js"></script>
  <script type="text/javascript" src="scripts/settings.js"></script>
  <script type="text/javascript" src="scripts/title.js"></script>
</head>
<body>

  <div id="map"></div>
  <div id="mySidebar3" class="sidebar" style="background-color: lightgrey; left: -500px; top: 65px; padding: 10px; padding-top:40px; width:365px;" >
    <span style="font-size:20px; font-weight:bold;">American History</span><br>
    <div style="padding:2px;"></div>
    Humans have lived on the North American continent for more than 120,000 years;
    creating a cultural history that is as vibrant as it is diverse.<br>
    <div style="padding:3px;"></div>
    Ancestral historians estimate that tens of thousands of unique groups lived in this region over the last 100,000 years.
    Indigenous Americans lived predominantly in hunter-gatherer groups with loosely defined territory that was ever changing.
    <div style="padding:3px;"></div>
    The current map shows the territory of many of the tribes thatlived here during the last millennium.
    This data was borrowed from <a href='https://native-land.ca/'>Native-Land.ca</a>,
    please visit and support their site to learn about the territory, languages and treaties of native peoples. <br>
    <div style="padding:3px;"></div>
    <span style="font-size:20px; font-weight:bold;">The Census</span><br>
    <div style="padding:2px;"></div>
    The United States and its decennial census have existed for a little less than 250 years,
    equal to about 0.2% of the time that humans have lived on this continent.
    To properly understand the context of the US Census, it must be remembered that the United States
    was built on stolen land without the consent of native peoples.
  </div>
  <div id="mySidebar4" class="sidebar" style="background-color: lightgrey; left: -500px; top: 65px; padding: 10px; padding-top:40px; width:365px; white-space: wrap;" >
    <span>
      Maps can be saved by copying the token below.<br>
      Make sure to save it in a document for later use! <br>
    </span>
    <div style="padding:3px;"></div>
    <span>
      To access a previous map, paste your token in the box and click 'Go' <br>
    </span>
    <div style="padding:5px;"></div>
    <div>
      <button id="copy-button" type="submit" onclick="copyButton()">Copy</button>
      <button id="go-button" type="submit" onclick="goButton()">Go</button>
    </div>
    <div style="padding:5px;"></div>
    <div>
      <textarea id="settings-json" name="settings-json" rows="6" cols="47"></textarea>
    </div>
  </div>
  <div id="mySidebar2" class="sidebar" style="background-color: lightgrey; left: 4000px; margin-top:10px; padding: 10px; width:365px;">
    <div style="padding-bottom: 5px;">
      <span id="b-name" style="font-size: 25px;"></span>
    </div>
    <div>
      <div>
        <img class="tag-label" src="images/tag-pop.png">
        <span id="b-pop"></span>
        <span>👤</span>
      </div>
      <div>
        <img class="tag-label" src="images/tag-geoid.png">
        <span id="b-geoid"></span>
      </div>
      <div>
        <img class="tag-label" src="images/tag-area.png">
        <span id="b-area"></span>
        <span>mi<sup>2</sup></span>
      </div>
      <div>
        <img class="tag-label" src="images/tag-den.png">
        <span id="b-den"></span>
        <span>👤/mi<sup>2</sup></span>
      </div>
      <div style="padding: 5px; font-size:16px;">
        <a id="wiki-link" href="" target="_blank">Wiki</a>
        &nbsp&nbsp
        <a id="flag-link" href="" target="_blank">Flag</a>
      </div>
      <div id="held-data">      </div>
    </div>

  </div>
  <div id="mySidebar1" class="sidebar" style="background-color: black; left: -500px; top: 65px; padding: 10px; padding-top:40px; width:365px;">
    <div id="settings" style="font-weight:bold;">
      <table class="tableB" id="tabeleta" >
        <tr>
          <td>
            <span style="color:red; font-size: 1.2em; ">Data</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>Year</td>
          <td>
            <div id="year-select" onchange="collectSettings(); update();">
              <select id="year-select-" style="width:199px;">
                <option value="2010">2010</option>
              </select>
            </div>
          </td>
        </tr>
        <tr>
          <td>Geography</td>
          <td>
            <div id="geo-select" onchange="collectSettings(); update();">
              <select id="geo-select-" style="width:199px;">
                <option value="nation">Nation</option>
                <option value="state">State</option>
                <option value="county">County</option>
                <option value="csub">County Subdivision</option>
                <option value="place">Place</option>
                <option value="tract">Tract</option>
                <option value="group">Group</option>
                <option value="metroSA">Metro/Micro Stat Area</option>
                <option value="urban">Urban Area</option>
                <option value="zip">Zip Code</option>
                <option value="uschool">Unified School District</option>
              </select>
            </div>
          </td>
        </tr>
        <tr>
          <td>Concept</td>
          <td>
            <div id="concept-select" onchange="collectSettings(); updateConcept();">
              <select id="concept-select-" style="width:199px;">
                <option value="P1">P1 - TOTAL POPULATION </option>
                <option value="P2">P2 - URBAN AND RURAL</option>
                <option value="P3">P3 - RACE</option>
                <option value="P4">P4 - HISPANIC OR LATINO ORIGIN</option>
                <option value="P5">P5 - HISPANIC OR LATINO ORIGIN BY RACE</option>
                <option value="P6">P6 - RACE (TOTAL RACES TALLIED)</option>
                <option value="P7">P7 - HISPANIC OR LATINO ORIGIN BY RACE (TOTAL RACES TALLIED)</option>
                <option value="P8">P8 - RACE</option>
                <option value="P9">P9 - HISPANIC OR LATINO, AND NOT HISPANIC OR LATINO BY RACE</option>
                <option value="P10">P10 - RACE FOR THE POPULATION 18 YEARS AND OVER</option>
                <option value="H1">H1 - HOUSING UNITS</option>
                <option value="H2">H2 - URBAN AND RURAL</option>
                <option value="H3">H3 - OCCUPANCY STATUS</option>
                <option value="H4">H4 - TENURE</option>
                <option value="H5">H5 - VACANCY STATUS</option>
                <option value="H6">H6 - RACE OF HOUSEHOLDER</option>
                <option value="H7">H7 - HISPANIC OR LATINO ORIGIN OF HOUSEHOLDER BY RACE OF HOUSEHOLDER</option>
                <option value="H8">H8 - TOTAL RACES TALLIED FOR HOUSEHOLDERS</option>
                <option value="H9">H9 - HISPANIC OR LATINO ORIGIN OF HOUSEHOLDERS BY TOTAL RACES TALLIED</option>
                <option value="H10">H10 - TOTAL POPULATION IN OCCUPIED HOUSING UNITS</option>
                <option value="H11">H11 - TOTAL POPULATION IN OCCUPIED HOUSING UNITS BY TENURE</option>
                <option value="H12">H12 - AVERAGE HOUSEHOLD SIZE OF OCCUPIED HOUSING UNITS BY TENURE</option>
                <option value="H13">H13 - HOUSEHOLD SIZE</option>
                <option value="H14">H14 - TENURE BY RACE OF HOUSEHOLDER</option>
                <option value="H15">H15 - TENURE BY HISPANIC OR LATINO ORIGIN OF HOUSEHOLDER</option>
                <option value="H16">H16 - TENURE BY HOUSEHOLD SIZE</option>
                <option value="H17">H17 - TENURE BY AGE OF HOUSEHOLDER</option>
                <option value="H18">H18 - TENURE BY HOUSEHOLD TYPE BY AGE OF HOUSEHOLDER</option>
                <option value="H19">H19 - TENURE BY PRESENCE OF PEOPLE UNDER 18 YEARS (EXCLUDING HOUSEHOLDERS, SPOUSES, AND UNMARRIED PARTNERS)</option>
                <option value="H20">H20 - OCCUPIED HOUSING UNITS SUBSTITUTED</option>
                <option value="H21">H21 - ALLOCATION OF VACANCY STATUS</option>
                <option value="H22">H22 - ALLOCATION OF TENURE</option>
              </select>
            </div>
          </td>
        </tr>
        <tr>
          <td>Variable</td>
          <td>
            <div id="variable-select" onchange="collectSettings(); update();">
              <select id="variable-select-" style="width:199px;">
                <option value="P001001" onclick="update()" selected>P001001</option>
              </select>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:black;">.</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:Orange; font-size: 1.2em; ">3D</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>3D</td>
          <td>
            <div>
              <input type="checkbox" id="3d-mode" name="3d-mode" onclick="collectSettings(); updatePaint()">
            </div>
          </td>
        </tr>
        <tr>
          <td>3D Height</td>
          <td>
            <div>
              <input id="height" type="range" min="10" max="3000000" step="20000" value="100000" oninput="collectSettings(); updateVariable()">
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:black;">.</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:Yellow; font-size: 1.2em; ">Colors</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>Color<span style="color:black;">-</span>Scheme<span style="color:black;">.</span></td>
          <td>
            <div id="color-select" onchange="customColors=[null,null,null,null,null]; collectSettings(); update()">
              <select id="color-select-" style="width:145px;">
                <option value="Viridis">Viridis</option>
                <option value="Red">Red</option>
                <option value="Blue">Blue</option>
                <option value="Green">Green</option>
                <option value="Purple">Purple</option>
                <option value="Black">Black</option>
                <option value="Rainbow">Rainbow</option>
                <option value="Viridis Light">Viridis Light</option>
                <option value="Greyscale">Greyscale</option>
                <option value="Heat">Heat</option>
                <option value="Magma">Magma</option>
                <option value="Brown-Teal">Brown-Teal</option>
                <option value="Blue-Red">Blue-Red</option>
                <option value="Green II">Green II</option>
                <option value="Purple II">Purple II</option>
                <option value="Ocean">Ocean</option>
                <option value="Valentine">Valentine</option>
                <option value="Forest">Forest</option>
                <option value="Burnt Toast">Yellow-Orange-Brown</option>
                <option value="Cividis">Cividis</option>
                <option value="Plasma">Plasma</option>
                <option value="Warm">Warm</option>
                <option value="Cool">Cool</option>
                <option value="Barney">Barney</option>
                <option value="Watermelon">Watermelon</option>
              </select>
              <button style="width: 49px;" onclick="reverseColorScale()">Invert</button>
            </div>
          </td>
        </tr>

        <tr>
          <td>Scale</td>
          <td>
            <div id="scale-select">
              <select id="scale-select-" style="width:199px;" onchange="collectSettings(); update()">
                <option value="Linear" >Linear</option>
                <option value="Quantile" >Quantile</option>
              </select>
            </div>
          </td>
        </tr>
        <tr>
          <td>Tile Opacity</td>
          <td>
            <div>
              <input id="tileopacity-v" type="range" min="0" max="1" step=".01" value="0.5" oninput="collectSettings(); updateFillOpacity()">
              <span id="to-label">0.5</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:black;">.</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:Green; font-size: 1.2em; ">Numbers</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>Num Format</td>
          <td>
            <div id="numformat-select" onchange="collectSettings(); update()">
              <select style="width:199px;">
                <option value="short">Short</option>
                <option value="comma">Commas</option>
              </select>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:black;">.</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:Blue; font-size: 1.2em; ">Selection</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>Accumulate</td>
          <td>
            <div>
              <input type="checkbox" id="accumulate" name="accumulate" onclick="collectSettings(); clearAllHolds()">
              <button onclick="clearAllHolds()">Clear Holds</button>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:black;">.</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:Purple; font-size: 1.2em; ">Modes</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>Flag Mode</td>
          <td>
            <div>
              <input type="checkbox" id="flag-mode" name="flag-mode" onclick="collectSettings(); updateFlagMode()">
            </div>
          </td>
        </tr>
        <tr>
          <td>Wiki Mode</td>
          <td>
            <div>
              <input type="checkbox" id="wiki-mode" name="wiki-mode" onclick="collectSettings()">
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:black;">.</span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>
            <span style="color:#e72cdc; font-size: 1.2em; ">Map<span style="color:black;">..</span>Viewing<span style="color:black;">..</span></span>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>Views</td>
          <td>
            <div>
              <button onclick="lower48View()">Lower 48</button>
              <button onclick="alaskaView()">AK</button>
              <button onclick="hawaiiView()">HI</button>
              <button onclick="puertoRicoView()">PR</button>
            </div>
          </td>
        </tr>
        <tr>
          <td>Zoom</td>
          <td>
            <div>
              <input id="zoom-v" type="range" min="2" max="14" step="0.01" value="3.6" oninput="collectSettings(); updateZoom(this.value)">
              <span id="zoom-label">3.6</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>Pitch</td>
          <td>
            <div>
              <input id="pitch-v" type="range" min="0" max="90" step="1" value="0" oninput="collectSettings(); updatePitch(this.value)">
              <span id="pitch-label">0</span>
            </div>
          </td>
        </tr>
      </table>
    </div>
    <div style="padding: 20px; ">
    </div>
    <div style="width: 50%; margin: 0 auto; white-space: nowrap;">
      <button class="openbtn" style="background-color: red; border-radius: 5px;" onclick="closeNav()">Close Settings</button>
    </div>
  </div>

  <!-- <div id="mySidebar" class="sidebar" style="background-color: black; left: -500px; top: 65px; padding: 10px; width:365px;" >

  </div> -->
  <div id="move" style="z-index:50"></div>
  <!-- <div id="click" style="z-index:50"></div> -->
  <div id="geo-controls">
    <div id="geolocate" class="geolocate"></div>
    <div id="geocoder" class="geocoder"></div>
  </div>
  <div id="title">CensusMapper</div>

  <div style="position:fixed; z-index:9; top: 65px;">
    <button id="iconbtn-1" class="iconbtn" onclick="openNav()">
      <div class="tooltip">⚙️
        <span id="tooltip-1" class="tooltiptext">Settings</span>
      </div>
    </button>
    <button id="iconbtn-2" class="iconbtn" onclick="openNav3()">
      <div class="tooltip">⛰️
        <span id="tooltip-2" class="tooltiptext">Land Acknowledgement</span>
      </div>
    </button>
    <button id="iconbtn-3" class="iconbtn" onclick="openNav4()">
      <div class="tooltip">💾
        <span id="tooltip-3" class="tooltiptext">Save Map</span>
      </div>
    </button>
  </div>
  <div id="flag-div" style="z-index:6;">
    <img id="flog_img" style="width: auto;height: 300px;" src="">
  </div>

  <div id="legend">
    <div id="sqaures">
      <div style="padding:3px;">
        <div id='cwrap-0' class="color-picker-wrapper"><input type="color" value="transparent" id="cpick-0"></div>
        <div id="leg-square-0" class="legend-square" style="background:transparent;"></div>
      </div>
      <div style="padding:3px;">
        <div id='cwrap-1' class="color-picker-wrapper"><input type="color" value="transparent" id="cpick-1"></div>
        <div id="leg-square-1" class="legend-square" style="background:transparent;"></div>
      </div>
      <div style="padding:3px;">
        <div id='cwrap-2' class="color-picker-wrapper"><input type="color" value="transparent" id="cpick-2"></div>
        <div id="leg-square-2" class="legend-square" style="background:transparent;"></div>
      </div>
      <div style="padding:3px;">
        <div id='cwrap-3' class="color-picker-wrapper"><input type="color" value="transparent" id="cpick-3"></div>
        <div id="leg-square-3" class="legend-square" style="background:transparent;"></div>
      </div>
      <div style="padding:3px;">
        <div id='cwrap-4' class="color-picker-wrapper"><input type="color" value="transparent" id="cpick-4"></div>
        <div id="leg-square-4" class="legend-square" style="background:transparent;"></div>
      </div>
      <br>
      <div style="padding:3px;">
        <div id='cwrap-6' class="color-picker-wrapper"><input type="color" value="#32cc32" id="cpick-6"></div>
        <div id="leg-square-6" class="legend-square-outline" style="border:solid 5px #32cc32;"></div>
      </div>
      <div style="padding:3px;">
        <div id='cwrap-5' class="color-picker-wrapper"><input type="color" value="#e72cdc" id="cpick-5"></div>
        <!-- <div id="leg-square-5" class="legend-square" style="background:#e72cdc"></div> -->
        <div id="leg-square-5" class="legend-square-outline" style="border: solid 5px #e72cdc"></div>
      </div>
    </div>
    <div id="labels" ondblclick="getCustomRange();" style="padding-top:7px; position:absolute; top:0px; left:60px;">
      <div class="legend-label" ><span id='leg-label-0'>Min</span></div>
      <div class="legend-label" ><span id='leg-label-1'>Q1</span></div>
      <div class="legend-label" ><span id='leg-label-2'>Med</span></div>
      <div class="legend-label" ><span id='leg-label-3'>Q3</span></div>
      <div class="legend-label" ><span id='leg-label-4'>Max</span></div>
      <br>
      <div class="legend-label" ><span id='leg-label-6'>Hover</span></div>
      <div class="legend-label" ><span id='leg-label-5'>Held</span></div>
    </div>
    <div>

    </div>
  </div>
  <!-- <div id="intro">
  <div>
  <span id = "intro-title"></span>
</div>
<br>
<div style="width:480px; padding: 5px; border-radius: 10px;">
<span id = "intro-text" style="font-weight:bold;"></span>
<button id="next-1" class="next-button" style="opacity: 0" onclick="holder()">➜</button>
</div>
</div> -->
<!-- <div id="current-view">
<span style="font-size:20px;">Current Map View:<br></span>
<span id="cur-view" style="font-size:15px;">May 14 12:23am</span>
</div> -->
<script>

$(document).on('mousemove', function(e){
  $('#move').css({
    left:  e.pageX+10,
    top:   e.pageY+10
  });
});

$('#geo-controls').css('top',window.innerHeight-45)
$('#geo-controls').css('left',550)
// $('#mySidebar2').css('left',window.innerWidth)
//$('#mySidebar2').css('height',window.innerHeight-20)
// $('#mySidebar').css('top', "65px")
//$('#mySidebar').css('height', window.innerHeight-65)
let h = parseInt($('#legend').css("height").slice(0,-2))
$('#legend').css('top', `${window.innerHeight - h - 35}px`)

LORAX = {}
updateTitle()

mapboxgl.accessToken = 'pk.eyJ1Ijoic2FtbGVibGFuYyIsImEiOiJja2hneXNrOXUxOWdyMnF0OWgxdWRma3VsIn0.NClhc-lMIVbihpDxZ12YuQ';
var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/dark-v10', // style URL
  center: [-104.800644, 38.846127],
  zoom: 3.6,
  pitch: 0,
  interactive: true, // true required
});

map.doubleClickZoom.disable();

var geolocate = new mapboxgl.GeolocateControl({
  positionOptions: { enableHighAccuracy: true  },
  trackUserLocation: true
});

var geocoder = new MapboxGeocoder({
  accessToken: mapboxgl.accessToken,
  mapboxgl: mapboxgl,
  countries: 'us',
  placeholder:"Pie Town, New Mexico"
});

document.getElementById('geocoder').appendChild(geocoder.onAdd(map));
document.getElementById('geolocate').appendChild(geolocate.onAdd(map));

//map.scrollZoom.disable();

var hoveredId = null;
var heldDistricts = {};


map.on('load', function () {
  threeDContolSetup()
  main()
});
</script>
</body>
</html>
